<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Lights!</title>
		<link rel="stylesheet" href="styles.css" />
	</head>

	<body>
		<div id="intro">
			<div id="buttons">
				<button id="up">▲</button>
				<button id="down">▼</button>
				<button id="intro-close">X</button>
			</div>
			<h3>What is this?</h3>
			<p>Basically a demo for an interactive wallpaper with 2D lights. Please do note that the lighting effect is expensive and it will consume a considerable amount of GPU load (You will need a good GPU for this). I recommend looking at how much GPU is used in Task Manager before you decide to keep this wallpaper running. For reference, I get 200 FPS (capped) with 35% GPU load with a 4060TI with default settings. This will be much worse without a dedicated graphics card.</p>
			<h3>What can I do?</h3>
			<p>In the Wallpaper Engine version there is lyrics and audio support! Only Spotify works with lyrics mode, more info about this below. Right now you are in lyrics mode, play a song on Spotify to start the light show! or switch to Playable 1 for circles that jump with the beat. More modes will come.</p>
			<h3>Why is my lyrics out of sync / broken?</h3>
			<p>(IMPORTANT: because of how media information is provided the code for lyrics logic is messy and probably has bugs)</p>
			<p>This is due to how media timelines are provided. Unfortunately the information about songs comes with an unpredictable delay that make precise tracking impossible. The delay is acceptable on my machine, but if its way off for you let me know. If you are seeing wrong lyrics / no lyrics found that is because the LRCLIB database doesn't have the right information.</p>
			<h3>Why only Spotify?</h3>
			<p>Technically it can also work with Youtube Music but there is no way to differentiate normal YT videos from music ones. That being said I don't want to bombard the LRCLIB API with unnecessary requests, so Spotify only for now.</p>
			<h3>I want more customization / X feature</h3>
			<p>I am aware! There are many cool things that can be done with light and more will come, if you really want something feel free to lmk.</p>
			<h3>Technical Details / Links</h3>
			<p>See the Github repo (https://github.com/HalilB84/Lights). Please leave a star if you like this!</p>
			<p>Visit the website version (https://lights.halilb.dev/ | not much there currently).</p>
		</div>
		<div id="settings-flex">
			<button id="hide-settings">Hide Settings</button>
			<div id="settings">
				<div class="setting-row">
					<button id="intro-open">Toggle Intro</button>
				</div>
				<div class="setting-row">
					<label>Choose mode</label>
					<select id="mode">
						<option value="lyrics">Lyrics</option>
						<option value="video">Video</option>
						<option value="playable1">Playable 1</option>
						<option value="playable2">Playable 2</option>
					</select>
					<img src="help.svg" />
					<span class="tooltiptext">Here you can switch between different modes, these are in development with more to be added.</span>
				</div>

				<div class="setting-row">
					<label id="video-button" for="video-upload">Upload Video File</label>
					<label id="video-name" for="video-upload">No file</label>
					<input id="video-upload" type="file" accept="video/*" hidden />
					<img src="help.svg" />
					<span class="tooltiptext">Upload a video to start the light show. Important note: Wallpaper Engine only supports .webm and .ogv files but only .webm works properly.</span>
				</div>

				<button id="play-pause">Play / Pause</button>

				<div class="setting-row">
					<label>Volume</label>
					<input id="video-volume" type="range" min="0" max="1" step="0.001" />
					<span class="range-value" id="vv-value">50</span>
				</div>
				<div class="setting-row">
					<label>Video scale</label>
					<input id="video-scale" type="range" min="0" max="1" step="0.001" />
					<span class="range-value" id="vs-value">50</span>
				</div>
				<div class="setting-row">
					<label>Text scale</label>
					<input id="text-scale" type="range" min="0" max="3" step="0.001" />
					<span class="range-value" id="ts-value">100</span>
				</div>
				<div class="setting-row">
					<label>Radiance</label>
					<input id="radiance-modifier" type="range" min="0" max="2" step="0.001" />
					<span class="range-value" id="rm-value">100</span>
				</div>
				<div class="setting-row">
					<label>Beat Multiplier</label>
					<input id="beat-multiplier" type="range" min="0" max="100" step="1" />
					<span class="range-value" id="bm-value">12</span>
					<img src="help.svg" />
					<span class="tooltiptext">For Playable 1 make sure to turn the music volume up or crank up the beat multiplier to see the beat.</span>
				</div>
				<div class="setting-row">
					<label>Lyrics Offset</label>
					<input id="lyrics-offset" type="range" min="0" max="1.0" step="0.01" />
					<span class="range-value" id="lo-value">0.6</span>
					<img src="help.svg" />
					<span class="tooltiptext">Offsets the lyrics by a value between 0 and 1 seconds. This is to account for the delay between the actual song time and when the program gets that information.</span>
				</div>
				<div class="setting-row">
					<label for="show-fps">Show FPS</label>
					<input id="show-fps" type="checkbox" />
				</div>
				<div class="setting-row">
					<label for="fix-edges">Fix blocky edges</label>
					<input id="fix-edges" type="checkbox" />
				</div>
				<div class="setting-row">
					<label for="enable-rc">Enable Radiance Cascades</label>
					<input id="enable-rc" type="checkbox" />
					<img src="help.svg" />
					<span class="tooltiptext">Radiance Cascades is a global illumination technique that runs faster and doesn't have noise. Checking off this checkbox will default to shooting N random rays per pixel, however keeping it on for lighting is recommended for better performance and looks. Technical details on this can be found on Github. </span>
				</div>
				<div class="setting-row rc-collapse">
					<label for="2-pass-optimization">2 pass optimization</label>
					<input id="2-pass-optimization" type="checkbox" />
					<img src="help.svg" />
					<span class="tooltiptext">If performance is an issue, enable this. The cascade calculation happens in 2 passes, meaning if the overlay is 60 fps, the lighting is calculated at 30 fps. Because the overlay and the light are calculated at different speeds, there will be artifacts where the previous frame is visible for a split second.</span>
				</div>
				<div class="setting-row rc-collapse">
					<label for="bilinear-fix">Bilinear Fix</label>
					<input id="bilinear-fix" type="checkbox" />
					<img src="help.svg" />
					<span class="tooltiptext">Fixes the ringing artifacts in RC, but brings down performance as more rays are cast</span>
				</div>
				<div class="setting-row rc-collapse">
					<label for="srgb-fix">SRGB Fix</label>
					<input id="srgb-fix" type="checkbox" />
					<img src="help.svg" />
					<span class="tooltiptext">Lighting calculations needs to happen in linear space but textures are in srgb space, this makes that conversion. The reason its off by default is because it makes the ringing artifacts way more visible. There is a good chance that this is not working as intended.</span>
				</div>
			</div>
		</div>
		<script type="module" src="src/state.js"></script>
	</body>
</html>
